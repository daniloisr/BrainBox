<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"> 
    <title>BrainBox</title>
	<link rel="stylesheet" href="/css/common.css" />
</head>

<body>

<style>
.tab {
	padding-top:3px;
	padding-right:12px;
	padding-left:12px;
	padding-bottom:4px;
	cursor: pointer;
}
.tab.selected {
	background:#333;
}
#files, #projects {
	color:white;
	text-align:left;
	width:100%;
	border-collapse:collapse;
}
#files td, #projects td,
#files th, #projects th {
	padding:0px 4px;
}
#files, #projects,
#files th, #projects th {
	border-bottom:thin solid white;
}
#files a, #projects a {
	text-decoration:none;
}
</style>

<div style="width:100%;height:100%;display:flex;flex-direction:column;align-items:stretch">
	
	<!-- Header -->
	<div style="flex:0 0 64px">
		<div id="MyLogin"></div>
	</div>
	
	<!-- Content -->
	<div id="content" style="flex:1 1 auto;background:#222">
	
		<a href='/'>
			<img style='position:fixed;left:5px;top:5px;width:200px' src='/img/brainbox-logo-small.svg'/>
		</a>

		<div style="display:flex;height:calc(100% - 164px);align-items:stretch">

			<div style="flex:0 0 300px;background:#333">
				<table id="projectFiles">
					<tr>
						<th>File</th>
						<th>QC</th>
						<th>QC Comment</th>
					</tr>
				</table>
			<!--
					<h1 id="projectName"></h1>
					<p id="projectCreated"></p>
					<p id="projectFilesNumber"></p>
					<p id="projectCollaboratorsNumber"></p>
			-->
			</div>

			<div style="flex:1 0;background:#222">
					<div style="width:100%">
						<div>
							<a class="tab selected">Viewer</a>
							<a class="tab">Collaborators</a>
							<a class="tab">Settings</a>
						</div>
						<div style="width:100%;background:#333;padding:20px">
							<div id="viewer" style="padding:10px"></div>
							<table id="collaborators" style="padding:10px;display:none"></table>
							<div id="settings" style="padding:10px;display:none"></div>
						</div>
					</div>
			</div>
		</div>

	</div>
	
	<!-- Footer -->
	<div style="flex:0 0 100px;background:#000">
		<p style="width:100%;font-size:small;text-align:center"> 
			<a target="_blank" href="http://neuroanatomy.github.io">
				<img src="/img/naat-bw.svg" style="width:28px;height:28px;margin-right:4px;display:inline-block;vertical-align:middle"/>
			</a>
			<a target="_blank" href="http://neuroanatomy.github.io" class="linkNoULine">
				group de neuroanatomie appliquée et théorique
			</a>
		</p>
	</div>
</div>

<script src="/lib/jquery-1.11.0.min.js"></script>
<script src="/lib/mylogin/login.js"></script>
<script>

	// Init login widget
	MyLoginWidget.init($("#MyLogin"));

	var projectInfo='{{projectName}}';
	projectInfo=JSON.parse(projectInfo);
	$("#projectName").text(projectInfo.name);
	var creation=new Date(projectInfo.created);
	$("#projectCreated").text("Created on "+creation.toLocaleString());
	$("#projectFilesNumber").text(projectInfo.files.length+" Files");
	$("#projectCollaboratorsNumber").text(projectInfo.collaborators.length+" Collaborators");
	
	$("a.tab").click(function() {
		$("a.tab").removeClass("selected");
		$(this).addClass("selected");
		switch($(this).text()) {
			case "Viewer":
				$("#viewer").show();
				$("#collaborators").hide();
				$("#settings").hide();
				break;
			case "Collaborators":
				$("#viewer").hide();
				$("#collaborators").show();
				$("#settings").hide();
				break;
			case "Settings":
				$("#viewer").hide();
				$("#collaborators").hide();
				$("#settings").show();
				break;
		}
	});

	/*
		The list of all files visited by the project
		should be recovered from the database
	*/
	var str;
	for(var i=0;i<projectInfo.files.length;i++) {
		var name=projectInfo.files[i].split("/").pop();
		str+=[	"<tr>",
				"	<td>",
				"		<a href='"+location.origin+"/index.html?url="+projectInfo.files[i]+"'>"+name+"</a>",
				"	</td>",
				"	<td>1</td>",
				"	<td>No Comment</td>",
				"</tr>"].join("");
	}
	$("#projectFiles").append(str);
	
	/*
		The list of all projects to which the project
		participates should be recovered from
		the database
	*/
	str=[	"<tr>",
			"<th>Name</th>",
			"<th>Last visited</th>",
			"<tr>"].join();
	for(var i=0;i<projectInfo.collaborators.length;i++) {
		var name=projectInfo.collaborators[i].split("/").pop();
		str+=[	"<tr>",
				"	<td>",
				"		<a href='"+projectInfo.collaborators[i]+"'>"+name+"</a>",
				"	</td>",
				"	<td>14 July 2016</td>",
				"</tr>"].join("");
	}
	$("#collaborators").append(str);
	console.log(str);
	
	
</script>

</body>
</html>
