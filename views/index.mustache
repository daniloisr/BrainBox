<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
	<link rel="shortcut icon" type="image/x-icon" href="/favicon.png" />
    <title>{{title}}</title>
	<link rel="stylesheet" href="/stylesheets/style.css" />
	<link href='https://fonts.googleapis.com/css?family=Roboto:100' rel='stylesheet' type='text/css'>
</head>

<body>

<div style="width:100%;height:100%;display:flex;flex-direction:column">
	
	<!-- Login (fixed height) -->
	<div style="flex:0 0 64px">
		<div id="menu">
			<img id="addProject" title="add project" style='width:13px' src='/img/plus.svg'/>
			<img id="settings" title="settings" style='width:13px' src='/img/settings.svg'/>
			<img id="search" title="search" style='width:13px' src='/img/search.svg'/>
			<img id="doc" title="documentation" style='width:13px' src='/img/doc.svg'/>
			<div id="MyLogin">
				<span>{{{login}}}</span>
			</div>
		</div>
	</div>
	
	<!-- Content (variable height) -->
	<div id="content" style="flex:1 0 auto">
			
		<!-- Introduction -->
		<div id="intro">
			<img id="logo" src="img/brainbox-logo.svg" style="text-align:center"/><br />
			<h2>Real-time collaboration</h2>
			
			<div style="display:flex">
				<div style="flex:1 1 auto"></div>
				<div style="flex:0 1 500px">
					<p>
						BrainBox is a web application by <b><a target="_blank" href="http://neuroanatomy.github.io">NAAT</a></b> to
						visualise and segment collaboratively any brain MRI dataset available online.
						Segmentations are automatically saved and can be downloaded as Nifti 2 files or
						triangular meshes. Point BrainBox to your own Nifti 2 data, or try data catalogues
						created by the community.
					</p>
					<div style="width:calc( 100% - 20px);margin-left:10px;margin-top:30px;display:flex">
						<div style="flex:1 1 auto">
							<input id="url" type="text" placeholder="Enter the URL of an MRI (.nii.gz)"></input>
						</div>
						<div style="flex:0 0 32px">
							<div id="go" onclick="goToURL()">Go</div>
						</div>
					</div>
				</div>
				<div style="flex:1 1 auto"></div>
			</div>
		</div>
		<!-- End Introduction-->
		
		<!-- Splash -->
		<div id='splash'>
			<a href='/'>
				<img id='logo' src='/img/brainbox-logo.svg'/>
			</a>
			<div id='msgLog'></div>
		</div>
		<!-- End Splash -->
				
		<!-- Data -->
		<div id="data">		
			<!-- Small left-top logo -->
			<a href='/'>
				<img style='position:fixed;left:10px;top:5px;width:200px' src='/img/brainbox-logo-small_noFont.svg'/>
			</a>
			<div style="position:fixed;left:73px;top:21px;width:auto; font-family: Roboto, sans-serif; font-size: 36px; font-weight:100" id="fontLogo"> 
				<a href='/' style="font-family: Roboto, sans-serif; font-size: 36px; font-weight:100; text-decoration:none">BrainBox</a>
			</div>

			<!-- Data Flex -->
			<div style="display:flex;justify-content:center">
					<!-- AtlasMaker -->
					<div style="flex:0 1 auto">
						<!-- AtlasMaker -->
						<div id="stereotaxic" style="width:512px">
						</div>
						<!-- End AtlasMaker -->
					</div>
				
					<!-- Annotations -->
					<div style="flex:0 1 auto;vertical-align:top;padding-left:0.5rem">
						<ul>
							<li><b>Name</b><br/> <span id="name" contentEditable=true class='noEmpty'></span></li>
							<li><b>Data source</b></br> <span id="source"></span></li>
							<li><b>Inclusion date</b><br/> <span id="included"></span></li>
							<li>
								<b>Annotations</b><br/>
								<table id="info">
								<thead>
									<tr>
										<th>Name</th>
										<th>Project</th>
										<th>Label Set</th>
										<th>Owner</th>
										<th>Created</th>
										<th>Modified</th>
										<th>Access</th>
									</tr>
								</thead>
								</table>
								<div style="text-align:right">
									<img id="addAnnotation"    class="button" src='/img/plus-circle.svg'/>
									<img id="removeAnnotation" class="button" src='/img/minus-circle.svg'/>
									<img id="saveAnnotations"   class="button" src='/img/floppy.svg'/>
								</div>
							</li>
						</ul>
					</div>
			</div>
			<!-- End Data Flex -->
		</div>
		<!-- End Data -->

		<!-- Labels -->
		<div id="labelset">
			<div style="z-index:23;text-align:right">
				<img id="labels-close" class="button" src="/img/times-circle.svg"/>
			</div>

			<ul style="padding-left:1rem">
				<li>
					<b>Label Set</b><br/>
					<span id="labels-name"></span>
				</li>
				<li>
					<b>Labels</b><br/>
					<div id="label-list">
					</div>
					<div id="label-template">
						<div class="label-color"></div>
						<span class="label-name">Label Name</name>
					</div>
				</li>
			</ul>
		</div>
		<!-- End Labels -->

	</div>
	<!-- End Content -->
	
	<!-- Space (fixed height) -->
	<div style="flex:0 0 50px">
	</div>

	<!-- Footer (fixed height) -->
	<div style="flex:0 0 100px;background-color:#000">
		<p style="width:100%;font-size:small;text-align:center"> 
			<a target="_blank" href="http://neuroanatomy.github.io">
				<img src="img/naat-bw.svg" style="width:28px;height:28px;margin-right:4px;display:inline-block;vertical-align:middle"/></a>
			<a target="_blank" href="http://neuroanatomy.github.io" class="linkNoULine">
				group de neuroanatomie appliquée et théorique
			</a>
		</p>
	</div>
</div>

<!-- 
A few brains:
http://braincatalogue.org/data/Baboon/MRI.nii.gz
https://zenodo.org/record/44855/files/MRI-n4.nii.gz
http://files.figshare.com/2284784/MRI_n4.nii.gz
http://braincatalogue.org/data/Human/MRI-n4.nii.gz
https://dl.dropboxusercontent.com/u/363467/mprage003.nii.gz
-->

<script src="/lib/jquery-1.11.0.min.js"></script>
<script src="/js/brainbox.js"></script>

<script>

$("#login").click(function(){$.get("/login",function(r){console.log(r)})});
$("#logout").click(function(){$.get("/logout",function(r){console.log(r)})});

var version=1;
var brainsToTry=[
	"https://zenodo.org/record/44855/files/MRI-n4.nii.gz",
	"http://files.figshare.com/2284784/MRI_n4.nii.gz",
	"https://dl.dropbox.com/s/cny5b3so267bv94/p32-f18-uchar.nii.gz",
	"https://fcp-indi.s3.amazonaws.com/data/Projects/ABIDE_Initiative/RawData/NYU/0050952/session_1/anat_1/mprage.nii.gz"
]

// If brainbox's call contains an url, launch atlasMaker with it,
// otherwise, present the history in localStorage if it exists.

	if(localStorage.AtlasMaker) {
		var stored=JSON.parse(localStorage.AtlasMaker);
		if(stored.version && stored.version==version) {
			var str="<br/><p><b>Recently visited</b><br/>";
			for(var i=stored.history.length-1;i>=Math.max(0,stored.history.length-10);i--) {
				str+="<a href='"+location+"mri?url="+stored.history[i].url+"'>"+stored.history[i].url+"</a><br />";
			}
			str+="</p>";
			$("#intro").append(str);
		} else {
			localStorage.clear();
		}
	}
	
	if(localStorage.AtlasMaker==undefined || stored.history.length<5) {
		var str="<br/><p><b>Some brains to try</b><br/>";
		for(var i=0;i<brainsToTry.length;i++) {
			str+="<a href='"+location+"mri?url="+brainsToTry[i]+"'>"+brainsToTry[i]+"</a><br />";
		}
		str+="</p>";
		$("#intro").append(str);
	}
// Add URL loading
$("#url").keyup(function(e) {
	console.log(e,e.target);
	if (e.keyCode == 13) {
		goToURL(e);
	}
});
function goToURL(e) {
	var url=$("#url").val();
	location="/mri?url="+url;
};
</script>



</body>
</html>
