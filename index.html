<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"> 
    <title>BrainBox</title>
	<link rel="stylesheet" href="lib/jquery-ui.css">
	<style>
	 html {
		background-color:#222;
		font: 16px/24px "Lucida Grande", "Lucida Sans Unicode", Helvetica, Arial, Verdana, sans-serif;
		-webkit-font-smoothing: antialiased;
		-moz-font-smoothing: antialiased;
	 }
	 img#logo {
		margin-top:20px;
		margin-bottom:20px;
		margin-left:50%;
		transform:translate(-50%,0);
		width:250px;
	 }
	 input#url {
		margin-left:50%;
		transform:translate(-50%,0);
		width:60%;
		margin-top:60px;
	 }
	 h2, p {
		margin-left:50%;
		transform:translate(-50%,0);
		font-family: sans-serif;
		color:white;
		text-align:center;
		width:500px;
	 }
	 a {
		color:white;
	 }
	 .linkNoULine {
	 	text-decoration: none;
	 	font-weight: lighter;
	 }
	 #MyLogin {
	 	position:absolute;
	 	top:5px;
	 	right: 5px;
		font: 16px/24px "Lucida Grande", "Lucida Sans Unicode", Helvetica, Arial, Verdana, sans-serif;
	 }
	 #stereotaxic {
	 	margin-left:50%;
	 	transform:translate(-50%,0);
	 }
	/* Login
	-----------------------------------------------------------------------------*/
	.loginbox {
		border:1px solid lightGrey;
		position:absolute;
		top:10px;
		left:-150px;
		background-color:white;
		padding:20px;
		max-width:80%;
		margin-left: 50%;
		width: 300px;
		line-height:20px;
		box-shadow: 0 10px 10px 0 rgba(0, 0, 0, 0.5);
		z-index:20;
	}
	.loginbox * {
		color:black;
	}
	.loginbox #username,
	.loginbox #e-mail,
	.loginbox #password,
	.loginbox #repassword,
	.loginbox #registerLink,
	.loginbox #remind,
	.loginbox #warning {
		display:block;
	}
	.loginbox #username,
	.loginbox #e-mail,
	.loginbox #password,
	.loginbox #repassword {
		width:90%;
	}
	.loginbox #registerLink,
	.loginbox #remind {
		text-decoration: none;
		font-size:12px;
		font-weight: normal;
		width:40%;
	}
	.loginbox #sendLogin, 
	.loginbox #register,
	.loginbox #cancel {
		border-radius: 1px;
		border:1px solid lightGrey;
		background-color:white;
		height:18px;
		box-shadow: 0 0px 0px 0 rgba(0, 0, 0, 0.5);
	}
	/* atlasMaker
	-----------------------------------------------------------------------------*/
	#atlasMaker {
		color: white;
		font-size:10px;
	}
	#atlasMaker #resizable {
		position: relative;
	}
	#atlasMaker #info {
		position: absolute;
		bottom:5px;
		right:5px;
	}
	#atlasMaker #canvas {
		width:100%;
		height:100%;
		background-color:black;
		cursor:none;
	
		image-rendering:optimizeSpeed;             /* Legal fallback */
		image-rendering:-moz-crisp-edges;          /* Firefox        */
		image-rendering:-o-crisp-edges;            /* Opera          */
		image-rendering:-webkit-optimize-contrast; /* Safari         */
		image-rendering:optimize-contrast;         /* CSS3 Proposed  */
		image-rendering:crisp-edges;               /* CSS4 Proposed  */
		image-rendering:pixelated;                 /* CSS4 Proposed  */
		-ms-interpolation-mode:nearest-neighbor;   /* IE8+           */
	}
	#atlasMaker #tools-side {
		position:relative;
		width:100%;
	}

	#atlasMaker.fullscreen-mode {
		position:fixed;
		top:0px;
		left:0px;
		width: calc( 100% - 240px );	/* width of tools */
		height:100%;
		z-index:10;
	}
	#atlasMaker.fullscreen-mode #tools-side {
		position:fixed;
		top:0px;
		right:0px;
		width:240px;					/* width of tools */
		height:100%;
	}
	
	/* cursor
	------------------------------- */
	.drawingcursor {
		border: 1px solid #F00;
		position: absolute;
		pointer-events:none;
	}
	.hidepaintcursor {
		display: none;
	}

	#cursor {
		pointer-events: none;
		position:absolute;
		top:200px;
		left:200px;
		border:thin solid white;
		color:red;
		z-index:1000;
	}
	#finger {
		display:none;
	}
	.display-mode #finger {
		display:none;
	}
	.edit-mode #finger.touchDevice {
		position:absolute;
		top:200px;
		left:250px;
		width:40px;
		height:40px;
		border-style:solid;
		border-width:4px;
		border-radius:50%;
		display:inline;
	}
	#finger.move {
		border-color:yellow;
	}
	#finger.draw {
		border-color:green;
	}
	#finger.configure {
		border-color:orange;
	}
	
	/* chat log
	----------------------- */
	#log {
		width: auto;
		line-height:1;
		border: 1px solid #777;
		overflow: auto;
		background-color: #333;
	}
	
	.middle {
		position:absolute;
		top:50%;
		left:50%;
		transform: translate(-50%,-50%);
	}
	
	</style>
</head>

<body>

<div id="MyLogin"></div>

<div id="intro">
	<img id="logo" src="img/BrainBox_web.gif" style="text-align:center"/><br />
	<h2>Real-time collaboration</h2>
	<p>
		BrainBox is a web application by <b><a target="_blank" href="http://neuroanatomy.github.io">NAAT</a></b> to
		visualise and segment collaboratively any brain MRI dataset available online.
		Segmentations are automatically saved and can be downloaded as Nifti 2 files or
		triangular meshes. Point BrainBox to your own Nifti 2 data, or try data catalogues
		created by the community.
	</p>
	<input id="url" type="text" placeholder="Enter the URL of an MRI (.nii.gz)"></input>
	<div id="msgLog"></div>
</div>

<div id="stereotaxic" style="width:512px"></div>

<p style="width:100%;position:absolute;bottom:5px;font-size:small;text-align:center"> 
	<a target="_blank" href="http://neuroanatomy.github.io">
		<img src="img/naat-bw.svg" style="width:28px;height:28px;margin-right:4px;display:inline-block;vertical-align:middle"/></a>
	<a target="_blank" href="http://neuroanatomy.github.io" class="linkNoULine">
		group de neuroanatomie appliquée et théorique
	</a>
</p>

<!-- 
A few brains:
http://braincatalogue.org/data/Baboon/MRI.nii.gz
https://zenodo.org/record/44855/files/MRI-n4.nii.gz
http://files.figshare.com/2284784/MRI_n4.nii.gz
http://braincatalogue.org/data/Human/MRI-n4.nii.gz
https://dl.dropboxusercontent.com/u/363467/mprage003.nii.gz
-->

<!--
<div id="myStereo"></div>
-->

<script src="lib/jquery-1.11.0.min.js"></script>
<script src="lib/jquery-ui.js"></script>
<script src="lib/jquery.ui.touch-punch.min.js"></script>
<script src="lib/pako/pako.min.js"></script>
<script src="lib/mylogin/login.js"></script>
<script src="js/brainbox.js"></script>

<script>

// Init login widget
MyLoginWidget.init($("#MyLogin"));

var params=deparam();
var version=1;

// If brainbox's call contains an url, launch atlasMaker with it,
// otherwise, present the history in localStorage if it exists.
if(params.url) {
	var fullscreen=false;
	if(params.fullscreen)
		params.fullscreen=(params.fullscreen=="true");
		
	$("body").html([
		"<div id='intro' class='middle'>",
		" <img id='logo' src='img/brainbox-logo.svg'/>",
		" <div id='msgLog'></div>",
		"</div>",
		"<div id='stereotaxic' style='width:512px'></div>"
	].join(""));
	
	params.hash=BrainBox.hash(params.url);
	BrainBox.initBrainBox(params)
	.then($("#logo").remove());
} else {
	if(localStorage.AtlasMaker) {
		var stored=JSON.parse(localStorage.AtlasMaker);
		if(stored.version && stored.version==version) {
			var str="<br/><p><b>Recently visited</b><br/>";
			for(var i=0;i<stored.history.length;i++) {
				str+="<a href='"+location+"index.html?url="+stored.history[i].url+"'>"+stored.history[i].url+"</a><br />";
			}
			str+="</p>";
			$("body").append(str);
		} else {
			localStorage.clear();
		}
	}
}

function deparam() {
    var search = location.search.substring(1);
    var result = search?JSON.parse('{"' + search.replace(/&/g, '","').replace(/=/g,'":"') + '"}',
                     function(key, value) { return key===""?value:decodeURIComponent(value) }):{};
    return result;
}

// Add URL loading
$("#url").keyup(function (e) {
	if (e.keyCode == 13) {
		params.url=$("#url").val();
		params.hash=BrainBox.hash(params.url);
		location="/brainbox/index.html?url="+params.url;
		initBrainBox(params);
	}
});
</script>

</body>
</html>
